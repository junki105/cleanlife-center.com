!function(p){function u(){var i=p("<div/>").addClass("feedback").hide();return i.setNotice=function(t){var e=p("<p/>").html(t),t=p("<button/>").addClass("notice-dismiss");return t.on("click",function(t){t.preventDefault(),i.hide()}),p(this).removeClass().addClass("feedback"),p(this).html(e).append(t),this},i.setSuccess=function(t){return this.setNotice(t),p(this).addClass("success"),this},i.setError=function(t){return this.setNotice(t),p(this).addClass("error"),this},i}var l={minimumResultsForSearch:10,width:"70%"};p.fn.applySourceImport=function(t){this.each(function(){var i=this,e=p(this).data("type-import"),s=p(this).find("button.ilj-import"),o=p(this).find(".spinner"),n=p(this).find('select[name="ilj-import-intern-type"]'),r=p(this).find('input[type="checkbox"][id^="ilj-import-intern-"]'),a=u();a.insertBefore(p(this)),i.sourceSelection=[],r.each(function(){p(this).on("change",function(){var e=p(this).attr("name");p(this).is(":checked")?i.sourceSelection.push(e):i.sourceSelection=p.grep(i.sourceSelection,function(t){return t!=e})})}),s.on("click",function(t){return t.preventDefault(),a.hide(),p(this).attr("disabled",!0).removeClass("button-primary"),o.addClass("is-active"),null==n.val()||0===i.sourceSelection.length?(a.setError(ilj_tools.translation.error_import_selection).show(),o.removeClass("is-active"),void p(this).attr("disabled",!1).addClass("button-primary")):void p.ajax({url:ilj_tools.ajax_url,data:{action:"ilj_import_keyword_intern",nonce:ilj_tools.nonce,type_import:e,type_selection:n.val(),source_import:i.sourceSelection},type:"POST",success:function(t){a.setSuccess(ilj_tools.translation.import_success).show()},error:function(t){a.setError(ilj_tools.translation.error).show()},complete:function(t,e){n.find("option:selected").prop("selected",!1),n.ilj_select2(l),r.each(function(){p(this).prop("checked",!1)}),i.sourceSelection=[],o.removeClass("is-active"),s.attr("disabled",!1).addClass("button-primary")}})})})},p.fn.applyFileImport=function(t){var d=this;return this.createLoadingText=function(){var t=p("<span></span>").html("<small>"+ilj_tools.translation.loading+" - <span>0</span>%</small>").hide();return t.setPercent=function(t){p(this).find("span").text(t)},t},this.each(function(){var e=p.extend({fileSize:0,fileType:"."},p(this).data()),t=p(this).find('form[name^="ilj-import"]'),i=t.find(".import-file"),s=t.find(".button"),o=t.find(".ilj-progress"),n=o.find(".ilj-progress-bar"),t=t.find(".hint"),r=u(),a=d.createLoadingText(),l=p("<button/>").addClass("button button-primary ilj-import-settings-start").text(ilj_tools.translation.start_import).on("click",function(t){t.preventDefault(),c.hide(),p(this).attr("disabled",!0).removeClass("button-primary");var i=p("<span/>").addClass("spinner");p(this).after(i),i.addClass("is-active"),p.ajax({url:ilj_tools.ajax_url,data:{action:"ilj_start_import",nonce:ilj_tools.nonce,file_type:e.fileType},type:"POST",success:function(t){setTimeout(function(){r.hide(),s.show(),r.setSuccess(ilj_tools.translation.import_success),l.hide().attr("disabled",!1).addClass("button-primary"),i.remove(),r.show()},500)},error:function(t){var e=ilj_tools.translation.error;t.responseJSON.data&&(e=t.responseJSON.data),r.setError(e),setTimeout(function(){l.hide().attr("disabled",!1).addClass("button-primary"),c.hide(),r.show(),s.show(),i.remove()},500)}})}).hide().insertAfter(t),c=p("<button/>").addClass("button").text(ilj_tools.translation.cancel_import).on("click",function(t){t.preventDefault(),s.show(),r.hide(),l.hide(),c.hide()}).hide().insertAfter(l);n.setPercent=function(t){p(this).css("width",t+"%")},r.insertAfter(t),o.after(a),s.on("click",function(t){t.preventDefault(),i.click()}),i.on("change",function(t){t.preventDefault(),i[0].files[0].size>e.fileSize?r.setError(ilj_tools.translation.upload_error_filesize).show():((t=new FormData).append("action","ilj_upload_import"),t.append("file_type",e.fileType),t.append("file_data",i[0].files[0]),t.append("file_name",i[0].files[0].name),t.append("nonce",ilj_tools.nonce),p.ajax({url:ilj_tools.ajax_url,data:t,processData:!1,contentType:!1,dataType:"json",type:"POST",success:function(t){r.setNotice(ilj_tools.translation.upload_success),c.after(p("<div/>").addClass("clear")),setTimeout(function(){o.hide(),a.hide(),r.show(),c.show(),l.show()},800)},error:function(t){var e=ilj_tools.translation.error;t.responseJSON.data&&(e=t.responseJSON.data),r.setError(e),setTimeout(function(){o.hide(),a.hide(),r.show(),s.show()},800)},beforeSend:function(){r.hide(),s.hide(),n.setPercent(0),a.setPercent(0),o.show(),a.show()},xhr:function(){var t=p.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(t){t.lengthComputable&&(t=(t=t.loaded/t.total*100).toFixed(2),n.setPercent(t),a.setPercent(t))},!1),t}}),p(this).val(""))})}),this},p(document).ready(function(){p(".ilj-upload-form").applyFileImport(),p("button.ilj-export").on("click",function(){var t=p(this).data("export"),e=p(this).parent().find(".spinner");e.addClass("is-active");var i=window.location.href+"&ilj_export="+t;"keywords"==t&&p(this).closest(".wrap").find("input#ilj-export-empty").is(":checked")&&(i+="&empty=1");i=p("<iframe/>").attr("src",i).css("display","none");p("body").append(i),setTimeout(function(){e.removeClass("is-active")},500)}),jQuery("#ilj-import-intern-type-post, #ilj-import-intern-type-term").ilj_select2(l),p(".ilj-import-keywords").applySourceImport()})}(jQuery);