(this.webpackJSONPwpmdb=this.webpackJSONPwpmdb||[]).push([[6],{509:function(t,n,e){"use strict";e.r(n),e.d(n,"setConnectionStatus",function(){return N}),e.d(n,"setConnectionStatusBatch",function(){return R}),e.d(n,"resetMigration",function(){return A}),e.d(n,"updateConnectionState",function(){return L}),e.d(n,"setError",function(){return U}),e.d(n,"copyLicenseToRemote",function(){return V}),e.d(n,"updatePluginOnRemote",function(){return I}),e.d(n,"retryOverHTTP",function(){return B}),e.d(n,"shouldShowSSLNotice",function(){return J}),e.d(n,"setConnectedProfileName",function(){return M}),e.d(n,"handleTableSelects",function(){return D}),e.d(n,"connectToRemote",function(){return F}),e.d(n,"changeConnection",function(){return G});var r=e(14),c=e(2),a=e(3),o=e.n(a),u=e(8),i=e(20),s=e.n(i),l=e(9),p=e(1),b=e(7),f=function(t){var n=0;if(0===t.length)return window.wpmdb_strings.connection_info_missing;var e=function(t){var n=t.split("\n"),e=t;if(1===n.length){var r=t.trim().split(" ");2===r.length&&(!1===window.wpmdb_data.openssl_available&&(r[0]=r[0].replace("https://","http://")),e=r[0]+"\n"+r[1])}return e}(t),c=e.split("\n"),a=Object(r.a)(c,2),o=a[0],u=a[1];return Object(b.n)(o)?("undefined"!==typeof u&&(n=u.length),32!==n&&40!==n?window.wpmdb_strings.connection_info_key_invalid:o===window.wpmdb_data.connection_info[0]?window.wpmdb_strings.connection_info_local_url:u===window.wpmdb_data.connection_info[1]?window.wpmdb_strings.connection_info_local_key:{url:o,key:u,str:e}):window.wpmdb_strings.connection_info_url_invalid},d=e(5),_=e(120),h=e(101),O=e(116),j=e(4),m=e(24),v=e(88),w=e(12),g=function(){return function(t,n){t(Object(d.a)(h.b,["connect"])),t(R({error:!0,button_status:"",connecting:!1}))}},y=e(34),k=e(255),x=e(39),S=e(100),T=function(t){var n,e=t.remote_site,r=t.local_site;switch(t.intent){case"pull":n={domain:{search:Object(b.i)(e.url),replace:Object(b.i)(r.this_url)},path:{search:e.path,replace:r.this_path}};break;case"push":n={domain:{search:Object(b.i)(r.this_url),replace:Object(b.i)(e.url)},path:{search:r.this_path,replace:e.path}};break;case"import":n={domain:{search:Object(b.i)(e.URL),replace:Object(b.i)(r.this_url)},path:{search:e.path,replace:r.this_path}}}return n.domain.enabled=!0,n.path.enabled=!0,n},C=e(43);function E(t,n,e){return function(r,c){var a=c();r({type:"UPDATE_REMOTE_SITE",payload:t.data});var o=T({intent:e,remote_site:t.data,local_site:a.migrations.local_site});return o=r(Object(x.a)("wpmdb_standard_replace_values",o)),r(Object(C.f)(o)),!!n&&(r(function(t){return function(n){n({type:w.f,connected:t})}}(n)),r(function(t,n){return function(e,r){if(r().migrations.local_site.this_prefix!==t.data.prefix&&e(Object(d.a)("SET_CONNECTION_STATUS",{key:"prefix_mismatch",statusVal:!0})),Object(b.h)(n,r())&&e(Object(m.f)()),Object(b.g)(n,r()))return e(g()),e(function(t){t(Object(d.a)("SET_CONNECTION_STATUS",{key:"show_mst_warning",statusVal:!0})),t(Object(d.a)(w.g,!0))}),!1}}(t,e)))}}var P=function(t){t.connectionState;var n=t.result,e=void 0===n?null:n,r=t.intent,a=void 0===r?null:r;return function(t,n){Object(l.b)(function(){var r=J(n()),i=Object(c.a)(Object(c.a)({},S.a),{},{button_status:"hidden"});r&&(i.ssl_notice=!0),t(R(i)),t(D(Object(j.e)("this_tables",n()),e.data.tables,Object(j.d)(["intent","tables_selected","backup_option","backup_tables_selected"],n()))),t(Object(m.b)(!0)),!1!==t(E(e,!0,a))&&(t(M()),t(function(t,n){var e=["database","custom_fields","standard_fields","save_profile","theme_plugin_files"];Object(O.a)("status",n()).ssl_notice&&e.push("connect"),t(Object(x.a)("postConnectionPanelsOpen",e)),Object(l.b)(function(){t(Object(y.l)(e)),t(Object(x.b)("postConnectionPanels")),t(Object(y.a)("database","connect"))})}),t(function(){var t=Object(u.a)(o.a.mark(function t(n){var e;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=[],window.hasOwnProperty("wpmdbmf")&&e.push("media_files"),window.hasOwnProperty("wpmdbtp")&&e.push("theme_plugin_files"),e.length>0&&(n(Object(y.b)(e)),n(Object(k.addonsLoaded)()));case 4:case"end":return t.stop()}},t)}));return function(n){return t.apply(this,arguments)}}()))})}},N=function(t,n){return Object(d.a)(_.a,{key:t,statusVal:n})},R=function(t){return function(n){n(Object(d.a)(_.b,t))}},A=function(t){return Object(d.a)(h.b,t)},L=function(t){return Object(d.a)(_.c,t)},U=function(t){return Object(d.a)(_.a,{key:"error",statusVal:t})},V=function(){return function(){var t=Object(u.a)(o.a.mark(function t(n,e){var r,c;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e(),c=r.migrations.connection_info.connection_state,t.next=4,Object(b.a)("/copy-license-to-remote",{url:c.url,key:c.key});case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t)}));return function(n,e){return t.apply(this,arguments)}}()},I=function(t){return function(){var n=Object(u.a)(o.a.mark(function n(e,r){var c,a,u;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return c=r(),a=c.migrations.connection_info.connection_state,n.prev=2,n.next=5,Object(b.a)("/update-plugin-on-remote",{url:a.url,key:a.key,slug:t});case 5:u=n.sent,n.next=15;break;case 8:if(n.prev=8,n.t0=n.catch(2),"AbortError"!==n.t0.name){n.next=13;break}return console.log("fetch aborted",n.t0),n.abrupt("return");case 13:return e(H(n.t0.message)),n.abrupt("return",!1);case 15:return n.abrupt("return",u);case 16:case"end":return n.stop()}},n,null,[[2,8]])}));return function(t,e){return n.apply(this,arguments)}}()},B=function(){return function(){var t=Object(u.a)(o.a.mark(function t(n,e){var r,a,u;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=e(),a=Object(c.a)({},r.migrations.connection_info.connection_state),u=r.migrations.current_migration.intent,a.url=a.url.replace("https","http"),a.value=a.value.replace("https","http"),n(N("retry_over_http",!0)),n(L(a)),n(F(u));case 8:case"end":return t.stop()}},t)}));return function(n,e){return t.apply(this,arguments)}}()},J=function(t){return Object(O.a)("status",t).retry_over_http},M=function(){return function(t,n){var e=Object(j.d)("intent",n()),r=Object(j.e)("url",n());s()(["push","pull"],e)&&(r=Object(j.h)("url",n()));var c=r.replace(/(^\w+:|^)\/\//,""),a="push"===e?Object(p.b)(Object(p.a)("Push to %s","wp-migrate-db"),c):Object(p.b)(Object(p.a)("Pull from %s","wp-migrate-db"),c);t(Object(m.d)(a))}},q=function(t){return function(n){var e=new AbortController;return n(Object(d.a)("SET_ABORT_CONTROLLER",{key:t,controller:e})),e}},z=function(t){return function(n){Object(l.b)(function(){n(R({connecting:!0,button_status:"disabled"})),n(L(Object(c.a)({},t)))})}},D=function(t,n,e){var c=Object(r.a)(e,4),a=c[0],o=c[1],u=c[2],i=c[3];return function(e,r){var c=t,s=n;"pull"===a&&(c=n,s=t);var l=c.filter(function(t){return o.includes(t)});if(l.length!==o.length&&e({type:w.u,payload:l}),"backup_manual_select"===u){var p=s.filter(function(t){return i.includes(t)});p.length!==i.length&&e({type:w.q,payload:p})}}},H=function(t){return function(n,e){var r,c=Object(v.a)(t);n((r=c,function(){var t=Object(u.a)(o.a.mark(function t(n,e){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(J(e())&&n(N("ssl_notice",!0)),!r.includes("#197")){t.next=5;break}return n(B()),t.abrupt("return");case 5:r.includes("401 Unauthorized")&&n(R({show_auth_form:!0})),r.includes("#195")&&n(N("copy_to_remote",!0)),r.includes("#196")&&n(N("update_plugin_on_remote",!0)),n(N("error_msg",r));case 9:case"end":return t.stop()}},t)}));return function(n,e){return t.apply(this,arguments)}}())),Object(O.a)("status",e()).retry_over_http?n(R({retry_over_http:!1,ssl_notice:!0})):n(g())}},F=function(t){return function(){var n=Object(u.a)(o.a.mark(function n(e,r){var c,a,u,i;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return c=Object(j.f)("connection_info",r()),a=c.connection_state,u=e(q("connect_to_remote")),e(z(a)),n.prev=3,n.next=6,Object(b.a)("/verify-connection",{url:a.url,key:a.key,intent:t},u);case 6:i=n.sent,n.next=16;break;case 9:if(n.prev=9,n.t0=n.catch(3),"AbortError"!==n.t0.name){n.next=14;break}return console.log("fetch aborted",n.t0),n.abrupt("return");case 14:return e(H(n.t0.message)),n.abrupt("return",!1);case 16:if(i.success){n.next=19;break}return e(H(i)),n.abrupt("return");case 19:return e(P({connectionState:a,result:i,intent:t})),n.abrupt("return",i);case 21:case"end":return n.stop()}},n,null,[[3,9]])}));return function(t,e){return n.apply(this,arguments)}}()},G=function(t){return function(){var n=Object(u.a)(o.a.mark(function n(e,r){var a,u,i,s,p,b,d;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(a=r(),u=a.migrations.current_migration.intent,i=a.migrations.connection_info.status.pasted,e(R({error:!1,button_status:""})),s=t.connection_state,p=f(t),b=Object(c.a)(Object(c.a)({},s),{},{value:p.str,url:p.url,key:p.key}),"string"!==typeof p){n.next=11;break}return d=Object(c.a)(Object(c.a)({},s),{},{value:t}),Object(l.b)(function(){e(L(d)),e(R({error:!0,button_status:"disabled",error_msg:p}))}),n.abrupt("return",p);case 11:e(L(b)),i&&Object(l.b)(function(){e(F(u,!0)),e(N("pasted",!1))});case 13:case"end":return n.stop()}},n)}));return function(t,e){return n.apply(this,arguments)}}()}}}]);